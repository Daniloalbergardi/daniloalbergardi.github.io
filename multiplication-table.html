<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Praticar Tabuada</title>
<meta name="description" content="Treino de tabuada (2 a 9). P√°gina est√°tica com HTML, CSS e JS inline." />
<style>
  :root{
    --bg:#f7fafc; --fg:#0f172a; --muted:#475569; --accent:#2563eb; --accent-2:#1d4ed8; --card:#ffffff; --ring:#e2e8f0;
    --ok:#16a34a; --err:#dc2626; --ok-bg:#dcfce7; --err-bg:#fee2e2;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif;
    color:var(--fg); background:linear-gradient(180deg,#ffffff, var(--bg));
  }
  .wrap{max-width:960px;margin:0 auto;padding:20px}
  header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin-bottom:8px}
  .brand{display:flex;align-items:center;gap:10px}
  .logo{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;background:#eef2ff;border:1px solid #c7d2fe;font-weight:800;color:#3730a3}
  nav{background:#eef2ff;border:1px solid #c7d2fe;border-radius:12px;padding:6px 8px}
  nav a{color:#1e293b;text-decoration:none;padding:8px 10px;border-radius:8px;display:inline-block;font-weight:600}
  nav a:hover{background:#e0e7ff}
  nav a[aria-current="page"]{background:#c7d2fe}

  h1.title{font-size:1.3rem;margin:8px 0 14px 0}

  .mode-selector{margin-bottom:20px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center}
  .mode-btn{flex:1;min-width:140px;padding:12px;border:2px solid #cbd5e1;background:#fff;border-radius:12px;cursor:pointer;font-weight:600;transition:.2s}
  .mode-btn.active{background:#3b82f6;color:#fff;border-color:#2563eb}
  .mode-btn:hover{border-color:#94a3b8}

  .options-panel{background:#f0f9ff;border:1px solid #bfdbfe;border-radius:12px;padding:12px;margin-bottom:16px}
  .options-panel label{display:flex;align-items:center;gap:8px;cursor:pointer;margin:6px 0;font-weight:500}
  .options-panel input[type="checkbox"]{cursor:pointer}

  .top-velocidade{background:#fef2f2;border:1px solid #fecaca;border-radius:12px;padding:12px;margin-bottom:16px}
  .top-velocidade-title{font-weight:700;color:#991b1b;margin-bottom:8px}
  .top-item{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #fee2e2}
  .top-item:last-child{border-bottom:none}
  .top-rank{font-weight:700;color:#dc2626;min-width:24px}
  .top-time{color:#7f1d1d;font-weight:600}
  .top-streak{background:#fcd34d;color:#78350f;padding:2px 6px;border-radius:4px;font-size:.85rem;font-weight:600}

  .stats-row{display:flex;gap:12px;flex-wrap:wrap;margin:8px 0}
  .stat-box{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:8px 12px;text-align:center}
  .stat-box-label{font-size:.85rem;color:#64748b;text-transform:uppercase}
  .stat-box-value{font-size:1.2rem;font-weight:700;color:#0f172a}

  .panel{background:var(--card);border:1px solid var(--ring);border-radius:16px;box-shadow:0 10px 30px #0000000d;padding:16px}
  .center{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}

  .grid{display:grid;gap:12px}
  .grid-choices{grid-template-columns:repeat(4,minmax(0,1fr))}
  @media (max-width:640px){ .grid-choices{grid-template-columns:repeat(2,minmax(0,1fr))} }

  .btn{
    appearance:none; border:1px solid #cbd5e1; background:#ffffff; color:#0f172a; padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:700;
    transition:.15s transform ease, .2s background ease, .2s box-shadow ease, .2s border-color ease;
    box-shadow:0 1px 0 #e2e8f0;
  }
  .btn:hover{transform:translateY(-1px); background:#f8fafc; border-color:#94a3b8}
  .btn:active{transform:translateY(0)}
  .btn-lg{font-size:1.1rem;padding:14px 16px}
  .btn-primary{background:linear-gradient(180deg, #60a5fa, #2563eb); color:#fff; border-color:#2563eb}
  .btn-primary:hover{background:linear-gradient(180deg, #93c5fd, #3b82f6); filter:saturate(1.05); box-shadow:0 4px 18px #3b82f633}
  .btn-ghost{background:#fff}
  .btn-inline{padding:10px 12px;font-size:.95rem}

  .stat{
    display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap; margin:8px 0 12px 0;
    color:var(--muted); font-weight:600
  }
  .badge{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:#eff6ff;border:1px solid #bfdbfe;color:#1e3a8a;font-size:.9rem}

  .question{font-size:2.2rem; font-weight:800; letter-spacing:.5px}
  .muted{color:var(--muted)}

  .inputRow{display:flex;gap:10px;justify-content:center;align-items:center;flex-wrap:wrap;margin-top:10px}
  input[type="number"]{
    width:140px; text-align:center; font-size:1.1rem; padding:10px 12px; border-radius:12px; border:1px solid #cbd5e1; outline:2px solid transparent;
    background:#ffffff;
  }
  input[type="number"]:focus{border-color:#94a3b8; box-shadow:0 0 0 4px #60a5fa33}

  .feedback{margin-top:14px; font-weight:700; min-height:28px}
  .ok{color:var(--ok); background:var(--ok-bg); border:1px solid #86efac; padding:8px 10px; border-radius:10px; display:inline-block}
  .err{color:var(--err); background:var(--err-bg); border:1px solid #fca5a5; padding:8px 10px; border-radius:10px; display:inline-block}

  .actions-end{display:flex;gap:10px;justify-content:center;margin-top:16px;flex-wrap:wrap}

  .hidden{display:none !important}

  .floating-check{
    margin-top:20px;
    display:flex;
    justify-content:flex-end;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">√ó</div>
        <div>
          <div style="font-weight:800">Treino de Tabuada</div>
          <div class="muted" style="font-size:.9rem">P√°gina est√°tica ‚Ä¢ 100% offline</div>
        </div>
      </div>
      <nav>
        <a href="#" aria-current="page">Tabuada</a>
      </nav>
    </header>

    <h1 class="title">Vamos praticar a Tabuada? Escolha:</h1>

    <!-- Tela inicial de escolha -->
    <section id="home" class="panel">
      <div class="mode-selector">
        <button class="mode-btn active" data-mode="classic">Tabuada Cl√°ssica</button>
        <button class="mode-btn" data-mode="pitagorica">Tabela Pitag√≥rica</button>
      </div>

      <!-- Top de Velocidade -->
      <div id="topVelocidadeContainer" class="top-velocidade">
        <div class="top-velocidade-title">üèÉ Top de Velocidade</div>
        <div id="topList">
          <div style="color:#991b1b;font-size:.9rem;text-align:center;padding:8px">Fa√ßa uma tabuada para ver seu top!</div>
        </div>
      </div>

      <!-- Seletor de Tabuada Cl√°ssica -->
      <div id="classicMode" class="grid grid-choices" style="width:100%">
        <button class="btn btn-lg" data-base="2">Tabuada do 2</button>
        <button class="btn btn-lg" data-base="3">Tabuada do 3</button>
        <button class="btn btn-lg" data-base="4">Tabuada do 4</button>
        <button class="btn btn-lg" data-base="5">Tabuada do 5</button>
        <button class="btn btn-lg" data-base="6">Tabuada do 6</button>
        <button class="btn btn-lg" data-base="7">Tabuada do 7</button>
        <button class="btn btn-lg" data-base="8">Tabuada do 8</button>
        <button class="btn btn-lg" data-base="9">Tabuada do 9</button>
      </div>

      <!-- Seletor de Tabela Pitag√≥rica -->
      <div id="pitagoricaMode" class="hidden">
        <div class="options-panel">
          <div style="margin-bottom:10px;font-weight:600;color:#1e293b">Op√ß√µes:</div>
          <label>
            <input type="checkbox" id="skipEasy" />
            Ignorar m√∫ltiplos de 1 e 2 (mais desafiador)
          </label>
          <label>
            <input type="checkbox" id="skipTen" />
            Ignorar tabuada do 10
          </label>
        </div>
        <div class="center">
          <button class="btn btn-primary btn-lg" id="startPitagorica">Come√ßar Tabela Pitag√≥rica</button>
        </div>
      </div>
    </section>

    <!-- Jogo -->
    <section id="game" class="panel hidden">
      <div class="stat">
        <div class="badge">Tabuada do <span id="lblBase">?</span></div>
        <div class="badge">Progresso: <span id="lblScore">0/0</span></div>
        <div class="badge" id="badgeTime">Tempo atual: <span id="lblTime">0,0s</span></div>
      </div>

      <!-- Estat√≠sticas da sess√£o atual -->
      <div class="stats-row">
        <div class="stat-box">
          <div class="stat-box-label">Melhor tempo</div>
          <div class="stat-box-value" id="bestTimeDisplay">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-box-label">Tempo m√©dio</div>
          <div class="stat-box-value" id="avgTimeDisplay">-</div>
        </div>
        <div class="stat-box">
          <div class="stat-box-label">Streak</div>
          <div class="stat-box-value" id="streakDisplay">-</div>
        </div>
      </div>

      <div class="center" style="padding:6px 0 2px 0">
        <div id="question" class="question">‚Äì √ó ‚Äì = ?</div>
        <div class="inputRow">
          <label for="answer" class="muted" style="position:absolute;left:-9999px">Resposta</label>
          <input id="answer" type="number" inputmode="numeric" placeholder="Resposta" />
          <!-- Validar inicialmente vis√≠vel; ser√° ocultado ap√≥s clique e "Pr√≥xima" ficar√° vis√≠vel -->
          <button id="btnCheck" class="btn btn-primary btn-inline">Validar</button>
          <button id="btnNext" class="btn btn-ghost btn-inline hidden">Pr√≥xima</button>
        </div>
        <div id="feedback" class="feedback" aria-live="polite"></div>
        <div style="margin-top:12px">
          <button id="btnSwitch" class="btn btn-ghost btn-inline">Escolher outra tabuada</button>
        </div>
      </div>

      <div id="end" class="center hidden" style="margin-top:10px">
        <div class="ok">Parab√©ns! Voc√™ concluiu a tabuada do <span id="endBase">?</span> üéâ</div>
        <div id="timeSummary" class="muted" style="margin-top:10px;font-weight:600"></div>
        <div class="actions-end">
          <button id="btnRestart" class="btn">Reiniciar a mesma tabuada</button>
          <button id="btnHome" class="btn">Escolher outra tabuada</button>
        </div>
      </div>
    </section>
  </div>
  <div id="floatingCheckWrapper" class="floating-check hidden">
    <button id="btnCheckFloating" type="button" class="btn btn-primary" aria-label="Validar resposta">Validar</button>
  </div>
<script>
(function(){
  // ===== Configura√ß√µes da Tabela Pitag√≥rica =====
  const pitagoricaMultiplications = [
    {a: 3, b: 3, result: 9},
    {a: 4, b: 3, result: 12},
    {a: 4, b: 4, result: 16},
    {a: 5, b: 3, result: 15},
    {a: 5, b: 4, result: 20},
    {a: 5, b: 5, result: 25},
    {a: 6, b: 3, result: 18},
    {a: 6, b: 4, result: 24},
    {a: 6, b: 5, result: 30},
    {a: 6, b: 6, result: 36},
    {a: 7, b: 3, result: 21},
    {a: 7, b: 4, result: 28},
    {a: 7, b: 5, result: 35},
    {a: 7, b: 6, result: 42},
    {a: 7, b: 7, result: 49},
    {a: 8, b: 3, result: 24},
    {a: 8, b: 4, result: 32},
    {a: 8, b: 5, result: 40},
    {a: 8, b: 6, result: 48},
    {a: 8, b: 7, result: 56},
    {a: 8, b: 8, result: 64},
    {a: 9, b: 3, result: 27},
    {a: 9, b: 4, result: 36},
    {a: 9, b: 5, result: 45},
    {a: 9, b: 6, result: 54},
    {a: 9, b: 7, result: 63},
    {a: 9, b: 8, result: 72},
    {a: 9, b: 9, result: 81}
  ];

  // ===== Elementos do DOM =====
  const elHome = document.getElementById('home');
  const elGame = document.getElementById('game');
  const lblBase = document.getElementById('lblBase');
  const lblScore = document.getElementById('lblScore');
  const elQ = document.getElementById('question');
  const elAns = document.getElementById('answer');
  const elFeedback = document.getElementById('feedback');
  const elEnd = document.getElementById('end');
  const elEndBase = document.getElementById('endBase');
  const btnCheck = document.getElementById('btnCheck');
  const btnNext = document.getElementById('btnNext');
  const btnCheckFloating = document.getElementById('btnCheckFloating');
  const floatingWrapper = document.getElementById('floatingCheckWrapper');
  const btnSwitch = document.getElementById('btnSwitch');
  const btnRestart = document.getElementById('btnRestart');
  const btnHome = document.getElementById('btnHome');
  const lblTime = document.getElementById('lblTime');
  const elTimeSummary = document.getElementById('timeSummary');
  const bestTimeDisplay = document.getElementById('bestTimeDisplay');
  const avgTimeDisplay = document.getElementById('avgTimeDisplay');
  const streakDisplay = document.getElementById('streakDisplay');
  const topList = document.getElementById('topList');
  const classicModeBtn = document.querySelector('[data-mode="classic"]');
  const pitagoricaModeBtn = document.querySelector('[data-mode="pitagorica"]');
  const classicModeDiv = document.getElementById('classicMode');
  const pitagoricaModeDiv = document.getElementById('pitagoricaMode');
  const skipEasyCheckbox = document.getElementById('skipEasy');
  const skipTenCheckbox = document.getElementById('skipTen');
  const startPitagoricaBtn = document.getElementById('startPitagorica');

  // ===== Estado =====
  let gameMode = 'classic'; // 'classic' ou 'pitagorica'
  let isPitagorica = false;
  let base = null;             // 2..9
  let remaining = [];          // multiplicadores ou objects que faltam acertar
  let attempts = 0;            // tentativas
  let hits = 0;                // acertos
  let current = null;          // objeto com {a, b, result} para pitag√≥rica ou n√∫mero para cl√°ssica
  let lastMultiplier = null;   // para evitar repetir imediatamente ap√≥s erro
  let feedbackTimer = null;    // controla o tempo de exibi√ß√£o do feedback positivo
  let questionStart = null;    // millis de quando a pergunta atual come√ßou
  let questionInterval = null; // atualiza o mostrador de tempo
  let totalTimeMs = 0;         // tempo total gasto nos acertos
  let timeRecords = [];        // tempos individuais por acerto
  let sessionRecords = {};     // { base: [{time, speed, date, timestamp}] }
  let currentBestTime = null;  // melhor tempo da sess√£o atual
  let streakCount = 0;         // quantas vezes o melhor tempo foi batido
  let currentStreak = 0;       // streak atual (quantas vezes bateu o record)

  // ===== LocalStorage =====
  function loadRecords(){
    const stored = localStorage.getItem('multiplicationRecords');
    sessionRecords = stored ? JSON.parse(stored) : {};
  }
  function saveRecords(){
    localStorage.setItem('multiplicationRecords', JSON.stringify(sessionRecords));
  }
  function addRecord(base, timeMs){
    const key = String(base);
    if(!sessionRecords[key]) sessionRecords[key] = [];
    const speed = (10 / (timeMs / 1000)).toFixed(2); // quest√µes por segundo
    sessionRecords[key].unshift({
      time: formatSeconds(timeMs),
      speed: speed,
      date: new Date().toLocaleDateString('pt-BR'),
      timestamp: Date.now(),
      ms: timeMs
    });
    // Mant√©m apenas os √∫ltimos 50 registros
    if(sessionRecords[key].length > 50) sessionRecords[key].pop();
    saveRecords();
  }

  // ===== Helpers =====
  function choice(arr){ return arr[Math.floor(Math.random()*arr.length)] }
  function shuffle(arr){ 
    const copy = [...arr];
    for(let i = copy.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [copy[i], copy[j]] = [copy[j], copy[i]];
    }
    return copy;
  }
  function focusAnswer(){
    setTimeout(()=>{
      elAns.focus({preventScroll:true});
      elAns.click();
      try{ elAns.select(); }catch(_){ /* ignore */ }
    }, 0);
  }
  function focusAnswerTrusted(){
    try{ elAns.focus({preventScroll:true}); elAns.select(); }
    catch(_){ elAns.focus(); }
  }
  function updateScore(){ lblScore.textContent = hits + '/' + attempts; }
  function formatSeconds(ms){
    const seconds = ms / 1000;
    if(seconds >= 60){
      const minutes = Math.floor(seconds / 60);
      const remainder = seconds - minutes * 60;
      const remainderStr = remainder.toFixed(1).replace('.', ',');
      return `${minutes}m ${remainderStr}s`;
    }
    return `${seconds.toFixed(1).replace('.', ',')}s`;
  }
  function updateTimerDisplay(ms){ if(!lblTime) return; lblTime.textContent = formatSeconds(ms); }
  function clearQuestionTimer(){ if(questionInterval){ clearInterval(questionInterval); questionInterval = null; } }
  function resetQuestionTimer(){ clearQuestionTimer(); questionStart = null; updateTimerDisplay(0); }
  function startQuestionTimer(){
    clearQuestionTimer(); questionStart = performance.now(); updateTimerDisplay(0);
    questionInterval = setInterval(()=>{ if(questionStart !== null){ updateTimerDisplay(performance.now() - questionStart); } }, 100);
  }
  function finalizeQuestionTime(){
    if(questionStart === null) return 0;
    const elapsed = performance.now() - questionStart; totalTimeMs += elapsed; timeRecords.push(elapsed);
    clearQuestionTimer(); questionStart = null; updateTimerDisplay(elapsed); return elapsed;
  }
  function resetTimeStats(){ totalTimeMs = 0; timeRecords = []; resetQuestionTimer(); if(elTimeSummary){ elTimeSummary.textContent = ''; } }
  function updateSessionStats(){
    if(!timeRecords.length) return;
    const bestTime = Math.min(...timeRecords);
    const avgTime = timeRecords.reduce((a,b)=>a+b,0) / timeRecords.length;
    
    if(currentBestTime === null || bestTime < currentBestTime){
      currentBestTime = bestTime;
      currentStreak = 1;
    } else if(Math.abs(bestTime - currentBestTime) < 50){
      currentStreak++;
    } else {
      currentStreak = 0;
    }
    
    bestTimeDisplay.textContent = formatSeconds(bestTime);
    avgTimeDisplay.textContent = formatSeconds(avgTime);
    if(currentStreak > 1){
      streakDisplay.textContent = `${currentStreak}x üî•`;
    } else {
      streakDisplay.textContent = '-';
    }
  }
  function updateEndSummary(){
    if(!elTimeSummary) return; if(!timeRecords.length){ elTimeSummary.textContent = ''; return; }
    const total = formatSeconds(totalTimeMs); const average = formatSeconds(totalTimeMs / timeRecords.length);
    elTimeSummary.textContent = `Tempo total: ${total} ‚Ä¢ Tempo m√©dio: ${average}`;
  }
  function updateTopVelocidade(){
    if(!topList) return;
    const html = [];
    let rank = 1;
    for(const baseKey in sessionRecords){
      const records = sessionRecords[baseKey];
      if(records.length === 0) continue;
      const bestRecord = records[0]; // primeiro √© o mais recente
      const allTimes = records.map(r=>r.ms).sort((a,b)=>a-b);
      const bestTime = allTimes[0];
      const recordCount = records.filter(r=>r.ms <= bestTime + 50).length;
      const streakText = recordCount > 1 ? `<span class="top-streak">x${recordCount}</span>` : '';
      html.push(`
        <div class="top-item">
          <span><span class="top-rank">#${rank}</span> Tabuada do ${baseKey}</span>
          <div style="display:flex;gap:8px;align-items:center">
            <span class="top-time">${bestRecord.time}</span>
            ${streakText}
          </div>
        </div>
      `);
      rank++;
    }
    if(html.length === 0){
      topList.innerHTML = '<div style="color:#991b1b;font-size:.9rem;text-align:center;padding:8px">Fa√ßa uma tabuada para ver seu top!</div>';
    } else {
      topList.innerHTML = html.join('');
    }
  }

  function showValidate(show){
    btnCheck.classList.toggle('hidden', !show);
    if(floatingWrapper){ floatingWrapper.classList.toggle('hidden', !show); }
  }
  function showNext(show){ if(btnNext){ btnNext.classList.toggle('hidden', !show); } }

  function getPitagoricaQuestions(){
    let questions = [...pitagoricaMultiplications];
    if(skipEasyCheckbox.checked){
      // Remove m√∫ltiplos de 1 e 2
      questions = questions.filter(q => q.a !== 1 && q.a !== 2 && q.b !== 1 && q.b !== 2);
    }
    if(skipTenCheckbox.checked){
      // Remove tabuada do 10
      questions = questions.filter(q => q.a !== 10 && q.b !== 10);
    }
    return shuffle(questions);
  }

  function startTable(n){
    isPitagorica = false;
    base = n; lblBase.textContent = base; elEndBase.textContent = base;
    remaining = Array.from({length:10}, (_,i)=>i+1); // 1..10
    attempts = 0; hits = 0; updateScore(); elFeedback.textContent=''; elFeedback.className='feedback';
    elHome.classList.add('hidden'); elGame.classList.remove('hidden'); elEnd.classList.add('hidden');
    showValidate(true); showNext(false);
    currentBestTime = null; currentStreak = 0; resetTimeStats();
    nextQuestion();
    focusAnswerTrusted();
  }

  function startPitagorica(){
    isPitagorica = true;
    lblBase.textContent = 'Pitag√≥rica'; elEndBase.textContent = 'Pitag√≥rica';
    remaining = getPitagoricaQuestions();
    base = 'pitagorica';
    attempts = 0; hits = 0; updateScore(); elFeedback.textContent=''; elFeedback.className='feedback';
    elHome.classList.add('hidden'); elGame.classList.remove('hidden'); elEnd.classList.add('hidden');
    showValidate(true); showNext(false);
    currentBestTime = null; currentStreak = 0; resetTimeStats();
    nextQuestion();
    focusAnswerTrusted();
  }

  function nextQuestion(){
    if(remaining.length===0){
      resetQuestionTimer(); updateEndSummary(); updateSessionStats(); showValidate(false); showNext(false);
      elEnd.classList.remove('hidden');
      return;
    }
    if(isPitagorica){
      current = choice(remaining);
      elQ.textContent = `${current.a} √ó ${current.b} = ?`;
    } else {
      const pool = remaining.length>1 && lastMultiplier ? remaining.filter(m=>m!==lastMultiplier) : remaining.slice();
      current = choice(pool);
      lastMultiplier = current;
      elQ.textContent = `${base} √ó ${current} = ?`;
    }
    elAns.value='';
    focusAnswer();
    startQuestionTimer();
  }

  function check(){
    if(feedbackTimer){ clearTimeout(feedbackTimer); feedbackTimer = null; }
    const raw = String(elAns.value).trim();
    if(raw===''){
      elFeedback.textContent = 'Digite uma resposta antes de validar.';
      elFeedback.className = 'feedback err';
      focusAnswer();
      return;
    }
    const val = Number(raw);
    if(Number.isNaN(val)){
      elFeedback.textContent = 'Digite um n√∫mero v√°lido.';
      elFeedback.className = 'feedback err';
      focusAnswer();
      return;
    }
    attempts++;
    let correct;
    if(isPitagorica){
      correct = current.result;
    } else {
      correct = base*current;
    }
    
    if(val===correct){
      hits++;
      remaining = remaining.filter(m=> isPitagorica ? m !== current : m !== current);
      elFeedback.textContent = 'Acertou!';
      elFeedback.className = 'feedback ok';
      updateScore();
      finalizeQuestionTime();
      updateSessionStats();
      feedbackTimer = setTimeout(()=>{
        elFeedback.textContent = '';
        elFeedback.className = 'feedback';
        feedbackTimer = null;
      }, 1000);
      if(remaining.length===0){
        setTimeout(()=>{ 
          updateEndSummary(); 
          if(typeof base === 'string') base = 'pitagorica';
          addRecord(base, totalTimeMs);
          updateTopVelocidade();
          elEnd.classList.remove('hidden'); 
        }, 400);
        showNext(false);
        showValidate(false);
      }else{
        showValidate(false);
        showNext(true);
      }
    }else{
      elFeedback.textContent = `Errou! (${isPitagorica ? `${current.a} √ó ${current.b}` : `${base} √ó ${current}`} = ${correct})`;
      elFeedback.className = 'feedback err';
      updateScore();
      resetQuestionTimer();
      showValidate(false);
      showNext(true);
    }
  }

  // ===== Modo de Sele√ß√£o =====
  function setGameMode(mode){
    gameMode = mode;
    classicModeBtn.classList.toggle('active', mode === 'classic');
    pitagoricaModeBtn.classList.toggle('active', mode === 'pitagorica');
    classicModeDiv.classList.toggle('hidden', mode !== 'classic');
    pitagoricaModeDiv.classList.toggle('hidden', mode !== 'pitagorica');
  }

  // ===== Events =====
  classicModeBtn.addEventListener('click', () => setGameMode('classic'));
  pitagoricaModeBtn.addEventListener('click', () => setGameMode('pitagorica'));
  
  document.querySelectorAll('[data-base]').forEach(btn=>{
    btn.addEventListener('click', ()=> startTable(Number(btn.dataset.base)) );
  });
  
  startPitagoricaBtn.addEventListener('click', startPitagorica);
  btnCheck.addEventListener('click', check);
  if(btnCheckFloating){ btnCheckFloating.addEventListener('click', check); }
  if(btnNext){
    btnNext.addEventListener('click', ()=>{
      showNext(false);
      showValidate(true);
      nextQuestion();
      focusAnswerTrusted();
    });
  }
  elAns.addEventListener('keydown', (e)=>{
    if(e.key==='Enter'){
      if(!btnCheck.classList.contains('hidden')){ e.preventDefault(); check(); }
      else{ e.preventDefault(); }
    }
  });
  btnSwitch.addEventListener('click', ()=>{
    resetQuestionTimer();
    elGame.classList.add('hidden'); elHome.classList.remove('hidden');
    showValidate(false); showNext(false);
  });
  btnRestart.addEventListener('click', ()=> {
    if(isPitagorica) startPitagorica();
    else startTable(base);
  });
  btnHome.addEventListener('click', ()=>{
    resetQuestionTimer();
    elGame.classList.add('hidden'); elHome.classList.remove('hidden');
    showValidate(false); showNext(false);
  });

  // Inicializa√ß√£o
  loadRecords();
  updateTopVelocidade();
})();
</script>
</body>
</html>
